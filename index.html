<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 AIOT é¦¬å¹´è³½é¦¬å¤§æœƒ</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg-base:#09090b;--bg-card:#18181b;--bg-card-hover:#1f1f24;--bg-muted:#27272a;
            --border:#3f3f46;--border-hover:#52525b;
            --text-primary:#f4f4f5;--text-secondary:#a1a1aa;--text-muted:#71717a;
            --gold:#ffd700;--gold-dim:rgba(255,215,0,0.12);
            --danger:#ef4444;--danger-dim:rgba(239,68,68,0.15);
            --success:#22c55e;--success-dim:rgba(34,197,94,0.12);
            --recover:#38bdf8;--recover-dim:rgba(56,189,248,0.15);
            --sprint:#fb923c;
            --horse-size:36px;
            --radius-sm:4px;--radius:6px;--radius-md:8px;--radius-lg:12px;--radius-pill:9999px;
        }
        *,*::before,*::after{box-sizing:border-box;}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Helvetica Neue',sans-serif;background:var(--bg-base);color:var(--text-primary);margin:0;padding:0;height:100vh;overflow:hidden;-webkit-font-smoothing:antialiased;}
        .header-bar{background:var(--bg-card);border-bottom:1px solid var(--border);padding:0 20px;height:56px;display:flex;justify-content:space-between;align-items:center;position:relative;z-index:1000;}
        .btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--border);border-radius:var(--radius-md);font-size:13px;font-weight:500;padding:7px 14px;cursor:pointer;background:var(--bg-muted);color:var(--text-primary);transition:background 0.15s,border-color 0.15s,transform 0.1s;user-select:none;}
        .btn:hover{background:var(--bg-card-hover);border-color:var(--border-hover);}
        .btn:active{transform:scale(0.97);}
        .btn-primary{background:var(--gold);color:#000;border-color:var(--gold);font-weight:600;}
        .btn-primary:hover{background:#e6c200;border-color:#e6c200;}
        .btn-danger{background:var(--danger);color:#fff;border-color:var(--danger);}
        .btn-danger:hover{background:#dc2626;border-color:#dc2626;}
        .btn-ghost{background:transparent;border-color:transparent;color:var(--text-secondary);}
        .btn-ghost:hover{background:var(--bg-muted);color:var(--text-primary);border-color:transparent;}
        .page{display:none;height:calc(100vh - 56px);width:100vw;position:absolute;top:56px;flex-direction:column;overflow-y:auto;}
        .page.active{display:flex;}
        .login-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:16px;width:100%;}
        .name-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:28px 12px;text-align:center;font-size:17px;font-weight:600;color:var(--text-primary);cursor:pointer;transition:border-color 0.15s,background 0.15s,transform 0.1s;}
        .name-card:hover{border-color:var(--gold);background:var(--gold-dim);transform:translateY(-1px);}
        .name-card:active{transform:scale(0.97);}
        .name-card.taken{opacity:0.25;filter:grayscale(1);pointer-events:none;cursor:default;}
        .name-card.wide{grid-column:1 / -1;}
        .horse-list{padding:12px 16px 100px;}
        .horse-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:16px;margin-bottom:10px;position:relative;cursor:pointer;transition:border-color 0.15s,background 0.15s,transform 0.1s;}
        .horse-card:hover{border-color:var(--border-hover);background:var(--bg-card-hover);transform:translateY(-1px);}
        .horse-card:active{transform:scale(0.98);}
        .horse-card.selected{border-color:var(--gold);background:var(--gold-dim);}
        .horse-card.occupied{opacity:0.4;filter:grayscale(0.6);pointer-events:none;cursor:default;}
        .horse-card.occupied:hover{transform:none;background:var(--bg-card);border-color:var(--border);}
        .owner-badge{position:absolute;top:12px;right:12px;border:1px solid var(--danger);color:var(--danger);background:var(--danger-dim);padding:2px 10px;border-radius:var(--radius-pill);font-size:11px;font-weight:500;z-index:2;}
        .horse-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
        .horse-header .horse-icon{font-size:26px;}
        .horse-header .horse-name{font-size:16px;font-weight:600;color:var(--gold);}
        .stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px 16px;}
        .stat-item{display:flex;flex-direction:column;gap:4px;}
        .stat-label{font-size:11px;font-weight:500;color:var(--text-muted);letter-spacing:0.3px;}
        .stat-bar{height:5px;background:var(--bg-muted);border-radius:var(--radius-pill);overflow:hidden;}
        .stat-fill{height:100%;background:var(--gold);border-radius:var(--radius-pill);transition:width 0.3s;}
        .horse-desc{font-size:12px;color:var(--text-secondary);font-style:italic;border-top:1px solid var(--border);margin-top:12px;padding-top:10px;}
        .rule-box{margin:12px 16px 4px;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px 16px;font-size:12px;color:var(--text-secondary);line-height:1.7;}
        .rule-box b{color:var(--text-primary);font-weight:600;}
        .rule-box .rule-title{color:var(--gold);font-weight:600;font-size:13px;margin-bottom:6px;display:block;}
        #page-track{background:var(--bg-base);top:0;height:100vh;}
        .track-bg{height:100%;position:relative;}
        #lanes-render-area{display:flex;flex-direction:column;height:100%;}
        .lane{position:relative;border-bottom:1px solid #1a1a1f;flex-grow:1;display:flex;align-items:center;padding-left:8px;}
        .lane:last-child{border-bottom:none;}
        .finish-line{position:absolute;right:0;top:0;bottom:0;width:36px;background:repeating-linear-gradient(45deg,#fff,#fff 8px,#1a1a1f 8px,#1a1a1f 16px);border-left:3px solid var(--gold);z-index:5;}
        .horse-pawn{position:absolute;left:0;display:flex;align-items:center;width:140px;transition:left 0.15s linear;}
        .horse-visual{font-size:var(--horse-size);transform:scaleX(-1);animation:gallop 0.4s infinite;transition:filter 0.25s;}
        .effect-sprint{filter:drop-shadow(0 0 10px var(--sprint)) scaleX(-1) !important;}
        .effect-exhausted{filter:drop-shadow(0 0 8px var(--danger)) scaleX(-1) !important;}
        .effect-slip{animation:slip-shake 0.18s infinite !important;}
        @keyframes gallop{0%,100%{transform:scaleX(-1) translateY(0);}50%{transform:scaleX(-1) translateY(-5px);}}
        @keyframes slip-shake{0%{transform:scaleX(-1) rotate(0deg);}25%{transform:scaleX(-1) rotate(18deg) translateY(-2px);}75%{transform:scaleX(-1) rotate(-18deg) translateY(2px);}100%{transform:scaleX(-1) rotate(0deg);}}
        .speech-bubble{position:absolute;top:-48px;left:8px;background:var(--bg-card);border:1px solid var(--border);color:var(--text-primary);padding:4px 10px;border-radius:var(--radius-md);font-size:12px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,0.35);z-index:20;white-space:nowrap;}
        .speech-bubble::after{content:'';position:absolute;bottom:-5px;left:12px;border-width:5px 5px 0;border-style:solid;border-color:var(--bg-card) transparent;}
        .bubble-danger{background:var(--danger-dim);border-color:var(--danger);color:var(--danger);}
        .bubble-danger::after{border-color:var(--danger-dim) transparent;}
        .bubble-recover{background:var(--recover-dim);border-color:var(--recover);color:var(--recover);}
        .bubble-recover::after{border-color:var(--recover-dim) transparent;}
        .bubble-sprint{background:rgba(251,146,60,0.15);border-color:var(--sprint);color:var(--sprint);}
        .bubble-sprint::after{border-color:rgba(251,146,60,0.15) transparent;}
        .bubble-finish{background:var(--gold-dim);border-color:var(--gold);color:var(--gold);font-size:18px;}
        .bubble-finish::after{border-color:var(--gold-dim) transparent;}
        .pawn-info{margin-left:8px;}
        .pawn-name{font-size:10px;font-weight:600;color:var(--text-secondary);letter-spacing:0.2px;}
        .stamina-track{width:44px;height:3px;background:var(--bg-muted);border-radius:var(--radius-pill);margin-top:3px;overflow:hidden;}
        .stamina-fill{height:100%;background:var(--success);border-radius:var(--radius-pill);transition:width 0.25s;}
        .stamina-fill.low{background:var(--danger);}
        #countdown-overlay{position:fixed;inset:0;background:rgba(9,9,11,0.88);display:none;align-items:center;justify-content:center;z-index:2000;font-size:140px;font-weight:700;color:var(--gold);letter-spacing:-4px;}
        .admin-monitor-box{background:var(--bg-card);border:1px solid var(--border);margin:12px 16px;padding:12px 14px;border-radius:var(--radius-lg);}
        .admin-monitor-title{font-size:11px;font-weight:600;color:var(--gold);margin-bottom:8px;letter-spacing:0.4px;}
        .player-status-tag{display:inline-flex;align-items:center;padding:3px 10px;border-radius:var(--radius-pill);font-size:11px;font-weight:500;margin:2px;background:var(--bg-muted);border:1px solid var(--border);color:var(--text-muted);transition:border-color 0.15s,color 0.15s;}
        .player-status-tag.ready{border-color:var(--success);color:var(--success);}
        .admin-persistent-ctrl{position:fixed;bottom:24px;left:24px;z-index:9999;display:none;flex-direction:column;gap:8px;}
        .player-ctrl{position:fixed;bottom:24px;right:24px;z-index:9999;display:none;flex-direction:column;gap:8px;}
        .btn-warn{background:#f59e0b;color:#111827;border-color:#f59e0b;font-weight:600;}
        .btn-warn:hover{background:#d97706;border-color:#d97706;}
        .btn[disabled]{opacity:0.45;cursor:default;transform:none;}
        #leaderboard-overlay{position:fixed;inset:0;background:rgba(9,9,11,0.85);backdrop-filter:blur(4px);z-index:10000;display:none;align-items:center;justify-content:center;}
        .leaderboard-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;width:88%;max-width:420px;padding:28px 24px 24px;box-shadow:0 16px 40px rgba(0,0,0,0.4);}
        .leaderboard-title{text-align:center;font-size:20px;font-weight:700;color:var(--text-primary);margin-bottom:4px;}
        .leaderboard-title span{color:var(--gold);}
        .leaderboard-subtitle{text-align:center;font-size:12px;color:var(--text-muted);margin-bottom:18px;}
        .rank-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-bottom:1px solid var(--border);}
        .rank-row:last-of-type{border-bottom:none;}
        .rank-row-left{display:flex;align-items:center;gap:12px;}
        .rank-badge{width:28px;height:28px;border-radius:var(--radius-pill);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;background:var(--bg-muted);color:var(--text-muted);border:1px solid var(--border);}
        .rank-badge.gold{background:rgba(255,215,0,0.18);border-color:var(--gold);color:var(--gold);}
        .rank-badge.silver{background:rgba(192,192,192,0.18);border-color:#c0c0c0;color:#c0c0c0;}
        .rank-badge.bronze{background:rgba(205,127,50,0.18);border-color:#cd7f32;color:#cd7f32;}
        .rank-name{font-size:14px;font-weight:600;color:var(--text-primary);}
        .rank-score{font-size:13px;font-weight:600;color:var(--gold);}
        .rank-score-sub{font-size:10px;color:var(--text-muted);font-weight:400;}
        .lb-btn{width:100%;margin-top:20px;padding:10px 0;font-size:14px;}
        .page-heading{text-align:center;padding:24px 16px 4px;}
        .page-heading h1{margin:0;font-size:22px;font-weight:700;color:var(--text-primary);letter-spacing:2px;}
        .page-heading h2{margin:0;font-size:18px;font-weight:600;color:var(--text-primary);}
        .page-heading h1 .accent,.page-heading h2 .accent{color:var(--gold);}
        .page-heading p{margin:6px 0 0;font-size:13px;color:var(--text-muted);}
        .banana-layer{position:absolute;left:0;right:0;top:0;bottom:0;pointer-events:none;}
        .banana{position:absolute;top:50%;transform:translate(-50%,-50%);font-size:20px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5));}
    </style>
</head>
<body>
<audio id="bgm" loop src="https://assets.mixkit.co/music/preview/mixkit-fast-game-action-loop-460.mp3"></audio>
<div id="countdown-overlay">READY</div>
<div class="header-bar" id="header">
    <div><button class="btn btn-ghost" id="btn-back" onclick="logout()" style="display:none;">â¬… è¿”å›</button></div>
    <div id="label-user-name" style="font-size:13px;font-weight:600;color:var(--gold);">GUEST</div>
</div>
<div id="page-login" class="page active">
    <div id="admin-login-monitor" style="display:none;" class="admin-monitor-box">
        <div class="admin-monitor-title">[ADMIN] å³æ™‚é¸é¦¬é€²åº¦</div>
        <div id="admin-status-grid"></div>
    </div>
    <div class="page-heading">
        <h1><span class="accent">AIOT</span> 2026 é¦¬å¹´è³½é¦¬çé‡‘è³½</h1>
        <p>é»æ“Šä½ çš„åå­—åŠ å…¥æ¯”è³½</p>
    </div>
    <div class="login-grid" id="login-grid"></div>
</div>
<div id="page-setup" class="page">
    <div class="page-heading">
        <h2>ğŸ è«‹é¸æ“‡æ‚¨çš„åƒè³½æˆ°é¦¬</h2>
    </div>
    <div class="rule-box">
        <span class="rule-title">ğŸ“Š å±¬æ€§å½±éŸ¿èªªæ˜</span>
        <b>é€Ÿåº¦</b> åŸºç¤ç§»å‹•é€Ÿåº¦ã€‚é€Ÿåº¦è¶Šå¿«ï¼Œé«”åŠ›æ¶ˆè€—ä¹Ÿè¶Šå¿«ã€‚<br>
        <b>é«”åŠ›</b> å½±éŸ¿çºŒèˆªåŠ›ã€‚æ•¸å€¼è¶Šé«˜ï¼Œè¶Šä¸å®¹æ˜“é€²å…¥ã€Œçˆ†è‚ã€èººå¹³ç‹€æ…‹ã€‚<br>
        <b>çˆ†ç™¼</b> è¡åˆºæ™‚çš„å¢ç›Šå¼·åº¦ã€‚æ•¸å€¼è¶Šé«˜ï¼Œè§¸ç™¼è¡åˆºæ™‚å™´ç™¼è¶Šé ã€‚<br>
        <b>é‹æ°£</b> æ•¸å€¼è¶Šé«˜ï¼Œè¶Šä¸å®¹æ˜“ç™¼ç”Ÿæ»‘å€’æ„å¤–ï¼Œä¸”è§¸ç™¼è¡åˆºæ©Ÿç‡è¶Šé«˜ã€‚
    </div>
    <div class="horse-list" id="horse-selection-list"></div>
</div>
<div id="page-track" class="page">
    <div class="track-bg">
        <div class="finish-line"></div>
        <div id="lanes-render-area"></div>
    </div>
</div>
<div class="admin-persistent-ctrl" id="admin-ctrl">
    <button class="btn btn-primary" id="admin-start-btn" onclick="adminStart()" style="padding:12px 28px;font-size:15px;">ğŸ é–‹å§‹æ¯”è³½</button>
    <button class="btn btn-danger" id="admin-reset-btn" onclick="adminReset()" style="padding:8px 18px;">ğŸ”„ é‡ç½®å…¨å ´</button>
</div>
<div class="player-ctrl" id="player-ctrl">
    <button class="btn btn-warn" id="banana-btn" onclick="dropBanana()">ğŸŒ ä¸Ÿé¦™è•‰çš® (1/1)</button>
</div>
<div id="leaderboard-overlay">
    <div class="leaderboard-card">
        <div class="leaderboard-title">ğŸ† <span>æ’è¡Œæ¦œ</span> ğŸ†</div>
        <div class="leaderboard-subtitle" id="lb-subtitle"></div>
        <div id="rankings-list"></div>
        <button class="btn btn-ghost lb-btn" id="lb-action-btn" style="display:none;"></button>
    </div>
</div>
<script>
const firebaseConfig={apiKey:"AIzaSyBHJtwI42b8i6z7zRw6tDgtR4ITSNKWrf8",authDomain:"aiot-d53dc.firebaseapp.com",databaseURL:"https://aiot-d53dc-default-rtdb.firebaseio.com",projectId:"aiot-d53dc",storageBucket:"aiot-d53dc.firebasestorage.app",messagingSenderId:"1021331253049",appId:"1:1021331253049:web:11f0695e8ab64eae0baae8",measurementId:"G-9YDKS70ZE7"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

// =====================================================================
// ç©åˆ†è¡¨
// =====================================================================
const POINTS = [3000,2000,1000,800,700,600,500,400,300,200,100]; // index 0 = ç¬¬1å

const horseLibrary=[
    {id:0,trait:"è–ªæ°´å°å·",stats:{spd:60,sta:95,burst:40,lck:70},desc:"æ“…é•·åœ¨ä¸»ç®¡è¦–ç·šå¤–ç·©æ­¥å‰é€²ï¼Œé«”åŠ›æ·±ä¸å¯æ¸¬ã€‚"},
    {id:1,trait:"ä¸‹ç­æˆ°ç¥",stats:{spd:55,sta:65,burst:95,lck:60},desc:"ä¸€æ—¦å¤•é™½è¥¿ä¸‹ï¼Œé«”åŠ›å†ä½ä¹Ÿèƒ½çˆ†ç™¼è¡åˆºã€‚"},
    {id:2,trait:"çˆ†è‚ç‹",stats:{spd:95,sta:25,burst:85,lck:30},desc:"èµ·æ­¥ç¬é–“å³å·”å³°ï¼Œä½†çˆ†è‚å€’æ•¸æ˜¯ä»–çš„æ—¥å¸¸ã€‚"},
    {id:3,trait:"æœƒè­°æˆ°é¬¥æ©Ÿ",stats:{spd:75,sta:60,burst:60,lck:80},desc:"ç¯€å¥æ„Ÿæ¥µå¼·ï¼Œä»¥ç©©å®šçš„é«˜èªé€Ÿå£“åˆ¶å…¨å ´ã€‚"},
    {id:4,trait:"å’–å•¡ä¸­æ¯’è€…",stats:{spd:80,sta:45,burst:75,lck:55},desc:"ä¾è³´å’–å•¡å› æé€Ÿï¼Œæ²’å’–å•¡æ™‚é«”åŠ›æ‰è¶…å¿«ã€‚"},
    {id:5,trait:"ç”©é‹å°ˆæ¥­æˆ¶",stats:{spd:45,sta:85,burst:30,lck:99},desc:"æ‹¥æœ‰ç¥ç´šé–ƒé¿ï¼Œå¹¾ä¹ä¸æœƒæ»‘å€’ï¼Œé‹æ°£é»æ»¿ã€‚"},
    {id:6,trait:"åŠ ç­é‚Šç·£äºº",stats:{spd:55,sta:90,burst:50,lck:65},desc:"é›–ç„¶æ²’å­˜åœ¨æ„Ÿï¼Œä½†é«”åŠ›é©šäººä¸”è·‘å¾—ç•°å¸¸ç©©ã€‚"},
    {id:7,trait:"æˆªç¨¿è¡åˆº",stats:{spd:40,sta:70,burst:99,lck:40},desc:"å¹³æ™‚éƒ½åœ¨æ··ï¼Œæœ€å¾Œé—œé ­è¡åˆºåŠ›é‡ç„¡äººèƒ½åŠã€‚"},
    {id:8,trait:"ç”¨å˜´åšäº‹",stats:{spd:85,sta:50,burst:70,lck:65},desc:"ç”¨æ°£å‹¢é©…å‹•å››è‚¢ï¼Œçˆ†ç™¼åŠ›èˆ‡é€Ÿåº¦å…¼å…·çš„å‹ç”·ã€‚"},
    {id:9,trait:"ä¸­åº¸ä¹‹é“",stats:{spd:70,sta:75,burst:65,lck:70},desc:"ä¸æ±‚æœ€å¿«ï¼Œä½†é«”åŠ›èˆ‡é‹æ°£è®“ä»–å§‹çµ‚åœ¨ç¬¬ä¸€æ¢¯éšŠã€‚"},
    {id:10,trait:"é€šéˆç‹",stats:{spd:50,sta:50,burst:40,lck:100},desc:"èƒ½é çŸ¥éœ€æ±‚ï¼Œé è‘—ç¥ç´šç›´è¦ºé¿é–‹æ‰€æœ‰éšœç¤™ã€‚"},
    {id:11,trait:"ç°¡å ±å¤§å¸«",stats:{spd:90,sta:30,burst:90,lck:40},desc:"ç•«é¢å¾ˆè¯éº—ï¼Œä½†çºŒèˆªåŠ›æ¥µä½ï¼Œæ²’è¬›å®Œå°±æ–·é›»ã€‚"},
    {id:12,trait:"Debugç‹",stats:{spd:65,sta:65,burst:65,lck:95},desc:"åªè¦ä»–åœ¨ï¼Œç¨‹å¼ç¢¼è‡ªå‹•ä¿®å¾©ï¼Œæ€éº¼ä¿®çš„?ä¸çŸ¥é“ï¼Œé‹æ°£å°±æ˜¯ä¸€åˆ‡ã€‚"},
    {id:13,trait:"èŒ¶æ°´é–“å®ˆé–€å“¡",stats:{spd:40,sta:100,burst:20,lck:80},desc:"æ¯å¤©æº–æ™‚å ±åˆ°ï¼Œé«”åŠ›å…¨å ´æœ€ç¡¬ï¼Œæ…¢æ…¢ç£¨åˆ°çµ‚é»ã€‚"},
    {id:14,trait:"Teasm æ½›æ°´å“¡",stats:{spd:75,sta:75,burst:50,lck:50},desc:"æ²’äº‹ä¸å›è¨Šï¼Œä¸€æ—¦å›è¨Šæ¯å°±æ˜¯ä¸€é³´é©šäººã€‚"}
];
const names=["Greg","Julia","Molly","DON","è±ªå“¥","Gimme","Erick","éŸ‹å¿—","Juli","Jason","Kris"];
const rankEmojis=["ğŸ¥³","ğŸ˜","ğŸ˜Š","ğŸ˜","ğŸ¤”","ğŸ˜“","ğŸ˜«","ğŸ˜­","ğŸ¥µ","ğŸ¤¬","ğŸ¦¥"];
let myName=localStorage.getItem('race_user')||"";
const isAdmin=new URLSearchParams(window.location.search).get('admin')==='1';
let serverOffset=0;
let currentRound=1;
let currentStatus='idle';
let bananaUses={};
let lastResetAt=0;
const FINISH_LINE_WIDTH=36;
db.ref(".info/serverTimeOffset").on("value",s=>{serverOffset=s.val()||0;});

// =====================================================================
// Init
// =====================================================================
function init(){
    if(isAdmin){
        document.getElementById('admin-ctrl').style.display='flex';
        document.getElementById('admin-login-monitor').style.display='block';
        document.getElementById('label-user-name').innerText="ADMIN";
    }
    const loginGrid=document.getElementById('login-grid');
    names.forEach((n,idx)=>{
        const d=document.createElement('div');
        d.className='name-card'+(idx===0?' wide':'');
        d.id=`user-${n}`;d.innerText=n;
        d.onclick=()=>{myName=n;localStorage.setItem('race_user',n);db.ref(`users/${n}`).set(true);document.getElementById('bgm').play();};
        loginGrid.appendChild(d);
    });
    const setupGrid=document.getElementById('horse-selection-list');
    horseLibrary.forEach((h,i)=>{
        const d=document.createElement('div');
        d.className='horse-card';d.id=`slot-${i}`;
        d.innerHTML=`<div class="owner-badge" id="owner-${i}" style="display:none;"></div><div class="horse-header"><span class="horse-icon">ğŸ</span><span class="horse-name">${h.trait}</span></div><div class="stat-grid">${renderStat("é€Ÿåº¦",h.stats.spd)}${renderStat("é«”åŠ›",h.stats.sta)}${renderStat("çˆ†ç™¼",h.stats.burst)}${renderStat("é‹æ°£",h.stats.lck)}</div><div class="horse-desc">${h.desc}</div>`;
        d.onclick=()=>{if(!myName)return;db.ref('assignments').once('value',snap=>{const a=snap.val()||{};if(Object.entries(a).some(([p,idx])=>idx===i&&p!==myName)){alert("æ…¢äº†ï¼è¢«é¸èµ°å›‰ï¼");}else{db.ref(`assignments/${myName}`).set(i);}});};
        setupGrid.appendChild(d);
    });
    listenFirebase();
}
function renderStat(label,val){return`<div class="stat-item"><span class="stat-label">${label}</span><div class="stat-bar"><div class="stat-fill" style="width:${val}%"></div></div></div>`;}
function logout(){if(myName){db.ref(`users/${myName}`).remove();db.ref(`assignments/${myName}`).remove();}localStorage.removeItem('race_user');myName="";location.reload();}
function updateBackButton(){
    const backBtn=document.getElementById('btn-back');
    if(!backBtn) return;
    if(!myName||isAdmin){backBtn.style.display='none';return;}
    backBtn.style.display=(currentRound===2)?'none':'inline-flex';
}
function updateBananaButton(){
    const ctrl=document.getElementById('player-ctrl');
    const btn=document.getElementById('banana-btn');
    if(!ctrl||!btn)return;
    const isRound2=currentRound===2;
    const canShow=!isAdmin&&!!myName&&isRound2&&currentStatus==='racing';
    ctrl.style.display=canShow?'flex':'none';
    if(!canShow)return;
    const used=!!bananaUses[myName];
    btn.disabled=used;
    btn.innerText=`ğŸŒ ä¸Ÿé¦™è•‰çš® (${used?0:1}/1)`;
}
function dropBanana(){
    if(!myName||isAdmin)return;
    if(currentRound!==2||currentStatus!=='racing')return;
    if(bananaUses[myName])return;
    db.ref(`gameState/bananaUses/${myName}`).set(true);
    db.ref('gameState/bananaRequests').push({by:myName,at:Date.now()+serverOffset});
    updateBananaButton();
}
function forceLocalReset(){
    isRacingNow=false;
    stopListeningSnapshot();
    localStorage.removeItem('race_user');
    myName="";
    document.getElementById('leaderboard-overlay').style.display='none';
    document.getElementById('btn-back').style.display='none';
    document.getElementById('label-user-name').innerText=isAdmin?'ADMIN':'GUEST';
    switchPage('page-login');
    updateBananaButton();
}
// =====================================================================
// Firebase Listeners
// =====================================================================
let isRacingNow=false;

function listenFirebase(){
    db.ref('gameState/resetAt').on('value',snap=>{
        const ts=snap.val();
        if(!ts||ts===lastResetAt)return;
        lastResetAt=ts;
        forceLocalReset();
    });
    db.ref('gameState/currentRound').on('value',rSnap=>{
        currentRound=rSnap.val()||1;
        updateBackButton();
        updateBananaButton();
    });
    db.ref('gameState/bananaUses').on('value',snap=>{
        bananaUses=snap.val()||{};
        updateBananaButton();
    });
    db.ref('users').on('value',snap=>{
        const u=snap.val();
        if(!u&&myName&&!isAdmin){localStorage.removeItem('race_user');location.reload();return;}
        const users=u||{};
        names.forEach(n=>{const el=document.getElementById(`user-${n}`);users[n]?el.classList.add('taken'):el.classList.remove('taken');});
        if(myName&&users[myName]){
            if(!isRacingNow)switchPage('page-setup');
            if(!isAdmin)document.getElementById('label-user-name').innerText=myName;
                        updateBackButton();
        }else{switchPage('page-login');document.getElementById('btn-back').style.display='none';}
        updateAdminMonitor(users);
    });
    db.ref('assignments').on('value',snap=>{
        const a=snap.val()||{};
        horseLibrary.forEach((_,i)=>{
            const el=document.getElementById(`slot-${i}`);
            const badge=document.getElementById(`owner-${i}`);
            const owner=Object.keys(a).find(k=>a[k]===i);
            el.classList.remove('selected','occupied');
            if(owner){badge.style.display='block';badge.innerText=`${owner} å·²é¸`;owner===myName?el.classList.add('selected'):el.classList.add('occupied');}
            else{badge.style.display='none';}
        });
    });
    // --- gameState/status ---
    db.ref('gameState/status').on('value',snap=>{
        const status=snap.val();
        currentStatus=status||'idle';
        if(status==='racing'){
            isRacingNow=true;
            if(isAdmin)document.getElementById('admin-start-btn').style.display='none';
            db.ref('gameState').once('value',fullSnap=>{
                const s=fullSnap.val();
                if(!s||s.status!=='racing')return;
                switchPage('page-track');
                setupTrackLanes(s.raceData);
                startListeningSnapshot();
                updateBananaButton();
            });
        } else if(status==='round1Done'){
            // ç¬¬ä¸€è¼ªçµæŸ â†’ é¡¯ç¤ºç¬¬ä¸€è¼ªæ¦œå–®ï¼ˆæ¦œå–®æ˜¯ overlayï¼Œä½†å…ˆæŠŠè·‘é“é åˆ‡æ‰ï¼‰
            isRacingNow=false;
            stopListeningSnapshot();
            switchPage('page-setup');
            db.ref('gameState/results').once('value',rSnap=>{
                if(rSnap.val()) showRound1Leaderboard(rSnap.val());
            });
        } else if(status==='finished'){
            // å…©è¼ªéƒ½å®Œ â†’ é¡¯ç¤ºæœ€çµ‚æ¦œå–®
            isRacingNow=false;
            stopListeningSnapshot();
            switchPage('page-setup');
            db.ref('gameState').once('value',gsSnap=>{
                const gs=gsSnap.val()||{};
                let final=gs.finalResults;
                if(!final||!final.length){
                    const round1=gs.round1Results||[];
                    const round2=gs.results||[];
                    if(round1.length&&round2.length){
                        const r1Map={};round1.forEach(r=>{r1Map[r.name]=r.points||0;});
                        final=round2.map(r=>({
                            name:r.name,
                            round1Points:r1Map[r.name]||0,
                            round2Points:r.points||0,
                            totalPoints:(r1Map[r.name]||0)+(r.points||0)
                        }));
                        final.sort((a,b)=>b.totalPoints-a.totalPoints);
                    }
                }
                if(final&&final.length) showFinalLeaderboard(final);
            });
        } else {
            // idle
            isRacingNow=false;
            if(isAdmin)document.getElementById('admin-start-btn').style.display='inline-flex';
            document.getElementById('leaderboard-overlay').style.display='none';
            stopListeningSnapshot();
            switchPage('page-setup');
            updateBananaButton();
            // è®€ currentRound ä¾†åˆ¤æ–·æ¨™é¡Œ
            db.ref('gameState/currentRound').once('value', rSnap => {
                const round = rSnap.val() || 1;
                if(round === 2){
                    document.querySelector('#page-setup .page-heading h2').innerHTML = 'ğŸ ç¬¬äºŒè¼ª â€” è«‹é¸æ“‡æ‚¨çš„åƒè³½æˆ°é¦¬';
                    if(isAdmin) document.getElementById('admin-start-btn').innerText = 'ğŸ é–‹å§‹ç¬¬äºŒè¼ªæ¯”è³½';
                } else {
                    document.querySelector('#page-setup .page-heading h2').innerHTML = 'ğŸ è«‹é¸æ“‡æ‚¨çš„åƒè³½æˆ°é¦¬';
                    if(isAdmin) document.getElementById('admin-start-btn').innerText = 'ğŸ é–‹å§‹æ¯”è³½';
                }
                // round 2: hide back button to prevent returning to name selection
                const backBtn = document.getElementById('btn-back');
                if(backBtn)
                    if(round === 2) backBtn.style.display = 'none';
                    else backBtn.style.display = myName ? 'inline-flex' : 'none';
                updateBananaButton();
                
            });
            if(document.getElementById('page-track').classList.contains('active')){
                switchPage('page-setup');
            }
        }
    });
}
function updateAdminMonitor(users){
    if(!isAdmin)return;
    db.ref('assignments').once('value',snap=>{
        const a=snap.val()||{};
        document.getElementById('admin-status-grid').innerHTML=Object.keys(users).map(name=>`<span class="player-status-tag ${a[name]!==undefined?'ready':''}">${name}: ${a[name]!==undefined?horseLibrary[a[name]].trait:"æœªé¸é¦¬"}</span>`).join('');
    });
}
function switchPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById('header').style.display=(id==='page-track')?'none':'flex';
}

// =====================================================================
// ADMIN â€” Game Loop
// =====================================================================
let adminLoopTimer=null;
let bananaRequestQueue=[];
let bananaRequestListener=null;

function adminStart(){
    // è®€ç•¶å‰ roundï¼ˆå¯èƒ½ä¸å­˜åœ¨ = ç¬¬ä¸€è¼ªï¼‰
    db.ref('gameState/currentRound').once('value', roundSnap => {
        const currentRound = roundSnap.val() || 1;

        db.ref('assignments').once('value',snap=>{
            const players=snap.val();
            if(!players)return alert("ç„¡äººåƒè³½ï¼");
            const raceData={};
            Object.entries(players).forEach(([name,hIdx])=>{
                const h=horseLibrary[hIdx];
                const events=[];
                for(let j=0;j<3;j++){
                    const t=8+(j*8)+Math.random()*5;
                    const type=(Math.random()*100<h.stats.lck)?'burst':'slip';
                    events.push({t,type});
                }
                raceData[name]={hIdx,events};
            });
            const startTime=Date.now()+serverOffset+4000;
            // å¯«å…¥ gameStateï¼Œä¿ç•™ round1Resultsï¼ˆupdate è€Œé setï¼‰
            db.ref('gameState').update({status:'racing',startTime,raceData,currentRound});
            startAdminGameLoop(startTime,raceData,currentRound);
        });
    });
}

function startAdminGameLoop(startTime,raceData,currentRound){
    if(adminLoopTimer)clearInterval(adminLoopTimer);
    const runners=Object.entries(raceData).map(([name,data])=>({
        name,stats:horseLibrary[data.hIdx].stats,events:data.events,
        progress:0,stamina:100,isRecovering:false,recoveryEndTime:0,
        finished:false,finishTime:null,finishRank:null,
        exhaustedUntil:0,activeEffect:null,
        bananas:[],bananaSlipUntil:0
    }));
    let lastElapsed=-999;
    let finishedCount=0;
    bananaRequestQueue=[];
    if(bananaRequestListener){
        db.ref('gameState/bananaRequests').off('child_added',bananaRequestListener);
        bananaRequestListener=null;
    }
    bananaRequestListener=db.ref('gameState/bananaRequests').on('child_added',snap=>{
        bananaRequestQueue.push({id:snap.key,...(snap.val()||{})});
    });

    adminLoopTimer=setInterval(()=>{
        const now=Date.now()+serverOffset;
        const elapsed=(now-startTime)/1000;
        if(elapsed<0){lastElapsed=elapsed;return;}
        const dt=(lastElapsed<0)?0.1:(elapsed-lastElapsed);
        lastElapsed=elapsed;

        if(currentRound===2&&bananaRequestQueue.length){
            const pending=[...bananaRequestQueue];
            bananaRequestQueue=[];
            pending.forEach(req=>{
                const leader=[...runners].filter(r=>!r.finished).sort((a,b)=>b.progress-a.progress)[0];
                if(!leader){db.ref(`gameState/bananaRequests/${req.id}`).remove();return;}
                const base=leader.progress+0.08;
                const pos=Math.min(0.97,Math.max(0.05,base+Math.random()*0.04));
                leader.bananas.push({pos,hit:false,by:req.by||""});
                db.ref(`gameState/bananaRequests/${req.id}`).remove();
            });
        }

        runners.forEach(r=>{
            if(r.finished)return;
            if(r.isRecovering){
                r.activeEffect=(elapsed<r.exhaustedUntil)?'exhausted':'recovering';
                if(elapsed>=r.recoveryEndTime){r.isRecovering=false;r.stamina=100;r.activeEffect=null;}
                return;
            }
            let spd=(r.stats.spd/100)*0.035;
            let drain=(1.5-r.stats.sta/100)*2.5;
            r.activeEffect=null;
            r.events.forEach(ev=>{
                if(elapsed>=ev.t&&elapsed<=ev.t+1.5){
                    if(ev.type==='burst'){spd*=(1.5+r.stats.burst/100);drain*=5;r.activeEffect='burst';}
                    else{r.progress=Math.max(0,r.progress-0.012*dt);r.activeEffect='slip';}
                }
            });
            if(elapsed<r.bananaSlipUntil){
                spd*=0.35;
                r.activeEffect='slip';
            }
            r.progress+=spd*dt;
            r.stamina=Math.max(0,r.stamina-drain*dt);
            r.bananas.forEach(b=>{
                if(!b.hit&&r.progress>=b.pos){
                    b.hit=true;
                    r.progress=Math.max(0,r.progress-0.02);
                    r.bananaSlipUntil=Math.max(r.bananaSlipUntil,elapsed+1.2);
                    r.activeEffect='slip';
                }
            });
            if(r.stamina<=0){r.isRecovering=true;r.recoveryEndTime=elapsed+5;r.exhaustedUntil=elapsed+1.5;r.activeEffect='exhausted';}
            if(r.progress>=1){r.progress=1;r.finished=true;r.finishTime=elapsed;finishedCount++;r.finishRank=finishedCount;r.activeEffect='finished';}
        });

        // å¯«å¿«ç…§
        const snapshot={};
        const bananaSnapshot={};
        runners.forEach(r=>{
            snapshot[r.name]={progress:r.progress,stamina:r.stamina,activeEffect:r.activeEffect,isRecovering:r.isRecovering,recoveryEndTime:r.recoveryEndTime,recoverySecondsLeft:r.isRecovering?Math.max(0,Math.ceil(r.recoveryEndTime-elapsed)):0,finished:r.finished,finishTime:r.finishTime,finishRank:r.finishRank};
            bananaSnapshot[r.name]=(r.bananas||[]).filter(b=>!b.hit).map(b=>b.pos);
        });
        snapshot._bananas=bananaSnapshot;
        db.ref('gameState/snapshot').set(snapshot);

        // å…¨éƒ¨è·‘å®Œ
        if(runners.every(r=>r.finished)){
            clearInterval(adminLoopTimer);
            adminLoopTimer=null;
            setTimeout(()=>{
                const sorted=[...runners].sort((a,b)=>a.finishTime-b.finishTime);
                const results=sorted.map((r,i)=>({name:r.name,finishTime:r.finishTime,rank:i+1,points:POINTS[i]||0}));

                if(currentRound===1){
                    // ç¬¬ä¸€è¼ªçµæŸï¼šå¯« results + round1Resultsï¼Œåˆ‡ç‹€æ…‹
                    db.ref('gameState').update({
                        status:'round1Done',
                        results,
                        round1Results: results,
                        currentRound: 2   // ä¸‹ä¸€è¼ªå‡†å¤‡ç‚ºç¬¬äºŒè¼ª
                    });
                } else {
                    // ç¬¬äºŒè¼ªçµæŸï¼šæ‹‰ round1Results è¨ˆç®—ç´¯åŠ 
                    db.ref('gameState/round1Results').once('value', r1Snap => {
                        const round1 = r1Snap.val() || [];
                        // å»ºç«‹ name â†’ round1 points çš„ map
                        const r1Map = {};
                        round1.forEach(r => { r1Map[r.name] = r.points || 0; });

                        // è¨ˆç®—ç´¯åŠ 
                        const finalResults = results.map(r => ({
                            name: r.name,
                            round1Points: r1Map[r.name] || 0,
                            round2Points: r.points,
                            totalPoints:  (r1Map[r.name] || 0) + r.points
                        }));
                        // æŒ‰ totalPoints é™åºæ’
                        finalResults.sort((a,b) => b.totalPoints - a.totalPoints);

                        db.ref('gameState').update({
                            status:'finished',
                            results,
                            finalResults
                        });
                    });
                }
            },1200);
        }
    },100);
}
function stopAdminGameLoop(){
    if(adminLoopTimer){clearInterval(adminLoopTimer);adminLoopTimer=null;}
    if(bananaRequestListener){
        db.ref('gameState/bananaRequests').off('child_added',bananaRequestListener);
        bananaRequestListener=null;
    }
    bananaRequestQueue=[];
}

// é–‹å§‹ç¬¬äºŒè¼ªï¼ˆå¾æ¦œå–®æŒ‰éˆ•è§¸ç™¼ï¼‰
function adminStartRound2(){
    document.getElementById('leaderboard-overlay').style.display='none';
    // ä¿ç•™ assignments ï¼Œç¬¬äºŒè¼ªå¯ç›´æ¥é–‹å§‹
    db.ref('gameState/bananaUses').remove();
    db.ref('gameState/bananaRequests').remove();
    db.ref('gameState').update({status:'idle',currentRound:2});
}

// é‡ç½®å…¨å ´
function adminReset(){
    stopAdminGameLoop();
    stopListeningSnapshot();
    db.ref('users').remove();
    db.ref('assignments').remove();
    db.ref('gameState/bananaUses').remove();
    db.ref('gameState/bananaRequests').remove();
    const resetAt=Date.now()+serverOffset;
    lastResetAt=resetAt;
    forceLocalReset();
    db.ref('gameState').set({status:'idle',currentRound:1,resetAt}); // set è€Œé updateï¼Œæ¸…æ‰æ‰€æœ‰å­ç¯€é»
}

// =====================================================================
// CLIENT â€” Snapshot
// =====================================================================
let snapshotListener=null;
let trackSetupDone=false;
let playerOrder=[];

function setupTrackLanes(raceData){
    if(trackSetupDone)return;
    trackSetupDone=true;
    playerOrder=Object.keys(raceData);
    const area=document.getElementById('lanes-render-area');
    area.innerHTML="";
    playerOrder.forEach((name,idx)=>{
        const div=document.createElement('div');
        div.className='lane';
        div.innerHTML=`<div class="banana-layer" id="banana-${idx}"></div><div class="horse-pawn" id="pawn-${idx}"><div id="bubble-${idx}"></div><div class="horse-visual" id="vis-${idx}">ğŸ</div><div class="pawn-info"><div class="pawn-name">${name}</div><div class="stamina-track"><div class="stamina-fill" id="stam-${idx}" style="width:100%"></div></div></div></div>`;
        area.appendChild(div);
    });
}
function startListeningSnapshot(){
    if(snapshotListener)return;
    db.ref('gameState/startTime').once('value',snap=>{if(snap.val())handleCountdown(snap.val());});
    snapshotListener=db.ref('gameState/snapshot').on('value',snap=>{const s=snap.val();if(s)renderFromSnapshot(s);});
}
function stopListeningSnapshot(){
    if(snapshotListener){db.ref('gameState/snapshot').off('value',snapshotListener);snapshotListener=null;}
    trackSetupDone=false;playerOrder=[];
}
function handleCountdown(startTime){
    (function tick(){
        const rem=(startTime-(Date.now()+serverOffset))/1000;
        if(rem>0){const ov=document.getElementById('countdown-overlay');ov.style.display='flex';ov.innerText=rem>3?"READY":Math.ceil(rem);requestAnimationFrame(tick);}
        else{document.getElementById('countdown-overlay').style.display='none';}
    })();
}
function renderFromSnapshot(snapshot){
    const area=document.getElementById('lanes-render-area');
    if(!area)return;
    const horseSize=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--horse-size'))||36;
    const finishLineX=Math.max(0,area.offsetWidth-FINISH_LINE_WIDTH-horseSize);
    const bananaMap=snapshot._bananas||{};
    playerOrder.forEach((name,i)=>{
        const data=snapshot[name];if(!data)return;
        const pawn=document.getElementById(`pawn-${i}`);
        const vis=document.getElementById(`vis-${i}`);
        const bub=document.getElementById(`bubble-${i}`);
        const stamFill=document.getElementById(`stam-${i}`);
        const bananaLayer=document.getElementById(`banana-${i}`);
        if(!pawn||!vis||!bub||!stamFill)return;
        pawn.style.left=(data.progress*finishLineX)+"px";
        stamFill.style.width=data.stamina+"%";
        stamFill.classList.toggle('low',data.stamina<25);
        vis.className="horse-visual";bub.className="";bub.innerText="";
        if(bananaLayer){
            const bananas=bananaMap[name]||[];
            bananaLayer.innerHTML=bananas.map(pos=>`<div class="banana" style="left:${pos*finishLineX}px">ğŸŒ</div>`).join('');
        }
        switch(data.activeEffect){
            case'burst':vis.classList.add('effect-sprint');bub.className="speech-bubble bubble-sprint";bub.innerText="ğŸ”¥ è¡åˆºï¼";break;
            case'slip':vis.classList.add('effect-slip');bub.className="speech-bubble bubble-danger";bub.innerText="ğŸ¤¡ æ»‘å€’ï¼";break;
            case'exhausted':vis.classList.add('effect-exhausted');bub.className="speech-bubble bubble-danger";bub.innerText="ğŸ˜µ å·²çˆ†è‚ï¼";break;
            case'recovering':vis.classList.add('effect-exhausted');bub.className="speech-bubble bubble-recover";bub.innerText=`ğŸ›Œ èººå¹³ä¸­ ${data.recoverySecondsLeft}s`;break;
            case'finished':
                const emoji=rankEmojis[(data.finishRank||1)-1]||"ğŸ";
                bub.className="speech-bubble bubble-finish";bub.innerText=emoji;break;
        }
    });
}

// =====================================================================
// Leaderboard â€” å…©ç¨®æ¨¡å¼
// =====================================================================
const medalClass=i=>i===0?'gold':i===1?'silver':i===2?'bronze':'';

// ç¬¬ä¸€è¼ªæ¦œå–®ï¼šé¡¯ç¤ºåæ¬¡ + æœ¬è¼ªç©åˆ†
function showRound1Leaderboard(results){
    document.getElementById('lb-subtitle').innerText = 'â€” ç¬¬ä¸€è¼ªçµæœ â€”';
    document.getElementById('rankings-list').innerHTML = results.map((r,i)=>
        `<div class="rank-row">
            <div class="rank-row-left">
                <div class="rank-badge ${medalClass(i)}">#${i+1}</div>
                <span class="rank-name">${rankEmojis[i]||""} ${r.name}</span>
            </div>
            <span class="rank-score">${r.points} é»</span>
        </div>`
    ).join('');
    // æ¦œå–®æŒ‰éˆ•ï¼šadmin çœ‹åˆ°ã€Œé–‹å§‹ç¬¬äºŒè¼ªã€ï¼Œé admin ä¸é¡¯ç¤º
    const btn = document.getElementById('lb-action-btn');
    if(isAdmin){
        btn.style.display='inline-flex';
        btn.className='btn btn-primary lb-btn';
        btn.innerText='ğŸ é–‹å§‹ç¬¬äºŒè¼ª';
        btn.onclick=adminStartRound2;
    } else {
        btn.style.display='none';
    }
    document.getElementById('leaderboard-overlay').style.display='flex';
}

// æœ€çµ‚æ¦œå–®ï¼šé¡¯ç¤ºå…©è¼ªç©åˆ† + ç¸½åˆ†
function showFinalLeaderboard(finalResults){
    document.getElementById('lb-subtitle').innerText = 'â€” å…©è¼ªç¸½åˆ†æ’å â€”';
    document.getElementById('rankings-list').innerHTML = finalResults.map((r,i)=>
        `<div class="rank-row">
            <div class="rank-row-left">
                <div class="rank-badge ${medalClass(i)}">#${i+1}</div>
                <span class="rank-name">${rankEmojis[i]||""} ${r.name}</span>
            </div>
            <div style="text-align:right;">
                <div class="rank-score">${r.totalPoints} é»</div>
                <div class="rank-score-sub">${r.round1Points} + ${r.round2Points}</div>
            </div>
        </div>`
    ).join('');
    // æ¦œå–®æŒ‰éˆ•ï¼šadmin çœ‹åˆ°ã€Œé‡ç½®å…¨å ´ã€
    const btn = document.getElementById('lb-action-btn');
    if(isAdmin){
        btn.style.display='inline-flex';
        btn.className='btn btn-danger lb-btn';
        btn.innerText='ğŸ”„ é‡ç½®å…¨å ´';
        btn.onclick=adminReset;
    } else {
        btn.style.display='none';
    }
    document.getElementById('leaderboard-overlay').style.display='flex';
}

// =====================================================================
init();
</script>
</body>
</html>
